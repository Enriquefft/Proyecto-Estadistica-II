---
title: <center><span>AN√ÅLISIS DE REGRESI√ìN LINEAL<span></center>
format: 
  html:
    toc: true
    toc-depth: 3
    toc-title: Contenido
    anchor_sections: TRUE # Mostrar anclaje de la secci√≥n al pasar el mouse
    code_download: TRUE # Permite a los lectores descargar el qmd
    code_folding: TRUE # Permite a los lectores cambiar a none, hide or show
    fig_caption: TRUE # Las imagenes se renderizan con caption
    theme: journal  #superhero cyborg, darkly, journal, vapor. Library "bslib"
    # runtime: shiny # sirve para que la librer√≠a shiny interactiva funcione. library("shiny")
    number-sections: true
    embed-resources: true
    author-title: Autores

author: 
  - Orlando Galarza
editor: visual
---

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

## Running Code

When you click the **Render** button a document will be generated that includes both content and the output of embedded code. You can embed code like this:

```{r}
1 + 1
```

## Quarto

Quarto enables you to weave together content and executable code into a finished document. To learn more about Quarto see <https://quarto.org>.

## 

# REGRESI√ìN LINEAL

Para encontrar **alguna relaci√≥n matem√°tica** entre varias **variables num√©ricas**, se usa los m√©todos de Regresi√≥n.

*Tipos de regresi√≥n:* Existen m√©todos de Regresi√≥n Lineal (aproxima la relaci√≥n entre variables mediante una ecuaci√≥n lineal) y de Regresi√≥n no Lineal ( la aproximaci√≥n es mediante una curva polin√≥mica, exponencial, logar√≠tmica, etc).

*Objetivo:* Se puede **predecir el valor de una de las variables**, conociendo el valor de las otras.

*M√©todo empleado*: Estudiamos Regresi√≥n Lineal basado en el **m√©todo de m√≠nimos cuadrados.** Este m√©todo consiste en minimizar la suma de los cuadrados de las diferencias de valores entre las ordenadas reales y las ordenadas pronosticadas. Entendi√©ndose que las ordenadas pronosticadas se encuentran sobre la ecuaci√≥n lineal.

*Tipos de regresi√≥n lineal:*

1\) Regresi√≥n Lineal simple: Se considera una sola variable de entrada x y una sola variable de salida y.

Modelo: $$
\hat{y}=\beta_{0}+\beta_{1} x
$$

2\) Regresi√≥n Lineal M√∫ltiple: Se considera varias variables de entrada xi y una sola variable respuesta yi.

Modelo:

$$
\hat{y}=\beta_{0}+\beta_{1} x_{1} +\beta_{2} x_{2} +\beta_{3} x_{3} ....+\beta_{k} x_{k}
$$

Variable Dependiente o variable respuesta: $y$

Variable Independientes o predictivas: $x$ o $x_{1}, x_{2}, ..., x_{k}$

# REGRESI√ìN SIMPLE

Modelo estad√≠stico:

$$
y= \beta_{0}+\beta_{1} x + e
$$

Modelo matem√°tico:

$$
\hat{y}=\beta_{0}+\beta_{1} x
$$

Considerar lo siguiente:

$$y: \text{valor real de la variable. Obtenido de una recolecci√≥n de datos}$$

$$\hat{y}: \text{valor estimado o predecido de la variable}$$

$e: \text{error aleatorio, que se supone ser√° una normal con media CERO:}$

Conclusi√≥n:

$$
y=\hat{y} + e
$$

Siempre, para cada predicci√≥n que se haga existir√° un error aleatorio $e$.

Estos errores $e_{1}, e_{2}, e_{3}, ..., e_{n}$ deben tener una distribuci√≥n normal con media CERO y varianza $\sigma ^{2}.$

$$
e\rightarrow N(0,\sigma^{2})
$$

Luego:

$$
y \rightarrow N(\beta_{0}+\beta_{1} x, \sigma^{2}) 
$$

**Caso:** *R√∫stica Construcciones* Es una empresa dedicada a la remodelaci√≥n de casonas antiguas. Ellos disponen de datos seg√∫n el cual, el valor de la remodelaci√≥n est√° en funci√≥n del valor nominal de la casona:

```{r}
x<- c(3,4,6,4,2,5)  # N√≥mina local de la casona que est√° en reparaci√≥n, en millones de soles

y<- c(6,8,9,5,4.5,9.5) # Valor de la remodelaci√≥n en unidades de 100000 soles.
```

Objetivo: Con estos datos , hallar una relaci√≥n entre x e y.

1)  Graficando un "diagrama de dispersi√≥n"

```{r}
pairs(x ~ y)
```

\* En el eje Y, debe ir la variable dependiente.

\* En el eje X, debe ir la variable independiente.

¬øcu√°l es la gr√°fica adecuada?

La gr√°fica adecuada tiene a los valores de X en el eje horizontal y a los valores de Y en el eje vertical. Debido a esto, la mejor gr√°fica es la que est√° debjo , hacia la izquierda.

Tambien se puede obtener la gr√°fica as√≠:

```{r}
plot(x, y) # aqu√≠ primero se coloca X, luego se coloca Y. la que se coloca primero ir√° en eje X, la otra va al eje Y.
```

Observamos que en el diagrama de dispersi√≥n hay una tendencia a "subir".

#### **Covarianza:** **Indica una medida de la tendencia, pero solo (+) o (-).**

(+) ==\> De subida.

(-) ==\> de bajada.

$$
V(x)=\frac{\sum_{1}^{n} x^{2}}{n}-(\overline{x})^{2} ... \text{ varianza}
$$

$$
cov(x,y)=\frac{\sum_{1}^{n} ( x_{i}.y_{i})}{n}-(\overline{x}.\overline{y})...  covarianza
$$

Para calcularlo con R:

```{r}
cov(x,y)
```

Como la covarianza es +2.5 (positivo) significa que hay una tendencia creciente de izquierda a derecha.

En general:

Si Covarianza (x,y) \>0 ==\> existe una tendencia creciente de izquierda a derecha.

Si Covarianza (x,y) \<0 ==\> existe una tendencia decreciente de izquierda a derecha.

Si Covarianza (x,y) =0 ==\> no existe una tendencia lineal entre x e y.

Pero con la covarianza no se sabe si esta relaci√≥n es buena o mala.

**Coeficiente de correlaci√≥n:**

$$
r= cor(x,y)=\frac{cov(x,y)}{\sqrt{V(x).V(y)}}
$$

```{r}
cor(x,y)
```

En general se cumple:

-   si \|r\|\>0.75 ==\> la relaci√≥n lineal es buena.

-   si \|r\|\<0.75 ==\> la relaci√≥n lineal es mala.

\+ si r=0 ==\> no hay relaci√≥n lineal entre las variables

Interpretaci√≥n en el ejemplo:

Como r= 0.83333 \> 0.75 entonces la relaci√≥n lineal es buena y es directa (a medida que x crece, entonces y tambi√©n crece)

lo cual tiene sentido, pues si mas cuesta la casona, entonces la empresa cobrar mas.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

```{r}
# Si ùëü=0 ==> No existe relaci√≥n lineal entre las variables.
# Si ùëü=1 ==> Existe relaci√≥n lineal perfecta y directa entre las variables.
# Si ùëü=‚àí1 ==> Existe relaci√≥n lineal perfecta e inversa entre las variables.
# Si ùëü>0.75 ==> Existe buena relaci√≥n lineal directa entre las variables
# Si ùëü<‚àí0.75 ==> Existe buena relaci√≥n lineal inversa entre las variables.}
# Si  0<|ùëü|<0.75 ==> Existe mala relaci√≥n lineal.

```

**HALLEMOS LA ECUACI√ìN DE REGRESI√ìN:**

1¬∞) *Transformamos los datos de los vectores, a un data frame*

```{r}
datosreg<-data.frame("X1"=x,"Y1"=y)

datosreg
```

2¬∞) *Ahora hallamos el reporte de regresi√≥n, usando **lm** (linear models)*

```{r}
resultados<- lm(datosreg$Y1 ~ datosreg$X1)   # primero debe ir Y1 y luego X1 

resultados

summary(resultados)
```

Obteniendo informaci√≥n del reporte anterior.

$$
\beta_{0}=2    \text{   y tambi√©n  } \beta_{1}=1.25
$$

Beta_o=2 ==\> geom√©tricamente es la intersecci√≥n de la recta con el eje Y.

Beta_1=1.25 ==\> es la pendiente de la recta.

Si pendiente\>0 ==\> la recta sube de izquierda a derecha.

Si pendiente\<0 ==\> la recta baja de izquierda a derecha..

Modelo:

$$
\hat{y}=2+1.25x
$$

$$
y=2+1.25x+e
$$

**INTERPRETACIONES:**

$$
\beta_{0}=a \rightarrow \text{Cuando x=0, entonces y=a}
$$

$$
\beta_{1}=b \rightarrow \text{Por cada unidad de aumento en x, la variable y var√≠a en promedio en b unidades}
$$

-   Si b\>0 ==\> Var√≠a: aumenta

-   Si b\<0 ==\> var√≠a: disminuye

    En el ejemplo:

-   x=Valor nominal de la casona (lo tasado por el municipio o ministerio de cultura: unidades de millon de soles)

-   y= Costo de reparaci√≥n de la casona en unidades de 100000soles.

-   Beta_0=2 ==\> Si la casona no tuviera valor el costo de reparaci√≥n ser√≠a 200000 soles.

-   Beta_1= 1.25 ==\> Por cada millon de soles que aumenta el valor de la casona, la compa√±ia de remodelaci√≥n aumentar√° **en promedio** en su cobro 125000 soles .

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

**NOTA: signo de Covarianza = Signo de** $\beta_1$**.**

En general la ecuaci√≥n ser√°:

$$
Y=\beta_{0}+\beta_{1}*X
$$

3¬∞) Graficamos el diagrama de dispersi√≥n y la recta de regresi√≥n:

```{r}
plot(datosreg$X1,datosreg$Y1,xlab="X1",ylab="Y1") # primero X, luego Y

abline(resultados)
```

No creer que en la imagen anterior, la recta viene del origen de coordenadas, pues en realidad la recta pasa por el punto (0;2) que se obtiene con el $\beta_{0}$

Hallando los errores

```{r}
x<- c(3,4,6,4,2,5) 

print(paste("Valores reales de x "))
x


y<- c(6,8,9,5,4.5,9.5) # valores reales de Y

print(paste("Valores reales de y"))
y

ye<- 2+1.25*x # Y estimados (lo que se calcula con la ecuaci√≥n de regresi√≥n obtenida)

print(paste("Valores estimados  de y "))
ye

ei<- y-ye # errores = Y real - Y estimado

print(paste("errores con las estimaciones"))
ei
```

## AN√ÅLISIS DE ERRORES

**NOTA:** *Debe observarse que la suma de errores da CERO.*

Los errores deben satisfacer 3 condiciones: Independencia, Normalidad, Homocedasticidad (varianzas iguales)

Para las siguientes pruebas tomamos alfa=0.05

1\) **Analizando la independencia de los residuos**

```{r}
install.packages("lmtest")
```

luego:

```{r}
library(lmtest)
```

***Test de Durwin Watson para probar la independencia de los errores, en regresi√≥n:***

Se va a probar:

$$
Ho: \text{Los errores son independientes}
$$

$$
Ha: \text{Los errores no son independientes}
$$

```{r}
dwtest(resultados,alternative ="two.sided",iterations = 1000)
```

**En general : siempre que DW est√© entre 1.5 y 2.5 se aceptar√° Ho.**

Como el estad√≠stico DW=1.5455 est√° \*entre 1.5 y 2.5\* se acepta Ho , es decir, los errores son independientes.

Tambien: *P-valor= 0.6733* \> alfa=0.05 ==\> Acepto Ho: *son independientes.*

\##################################################################

2\) **test de normalidad**

$$
Ho: \text{Los errores tienen distribuci√≥n normal, con media CERO}
$$

$$
Ha: \text{Los errores no tienen distribuci√≥n normal, con media CERO}
$$

**test de Kolmogorov Smirnov**

```{r}
ks.test(ei,mean(ei),sd(ei))
```

P-valor=1 \>alfa=0.05 ==\>\> Acepto Ho ==\> *"Los errores son normales con media CERO".*

3\) **la homocedasticidad:**

Prueba de Breusch--Pagan: (requiere *library(lmtest)*)

```{r}
library(lmtest)
```

se va a probar:

$$
Ho: \text{La varianza de los errores es constante  (homocedasticidad)}
$$

$$
Ha: \text{La varianza de los errores no es constante  (heterocedasticidad)}
$$

```{r}
bptest(lm(y~x))
```

como p valor es mayor que ALFA= 0.05 ==\> no rechazo Ho: Acepto Ho ==\> si hay homocedasticidad (las varianzas son iguales).

\####################################################################

\####################################################################

Los errores a data frame

```{r}
estimaciones<-data.frame("X1"=x,"Y1"=y,"Y.estimado"=ye,"errores"=ei)

estimaciones
```

\#########################################################################################

**Ejemplo 2: (para el estudiante)**

Hacer todo un an√°lisis de regresi√≥n para el data.frame : *cars*

```{r}
cars
```

Donde *speed* es la velocidad del m√≥vil ==\> x

*Distance:* la distancia de frenado del m√≥vil. ==\> y

Notemos que distancia de frenado, depende de la velocidad.

En general: Y siempre depende de X.,

**Su diagrama de dispersi√≥n:**

```{r}
plot(cars$speed, cars$dist)   # primero ingresar X, luego Y.
```

**Covarianza:**

```{r}
cov(cars$speed, cars$dist)
```

*Como es postiva significa que habria una relaci√≥n lineal ascendente de izquierda a derecha.* Relaci√≥n directa.

**Coeficiente de correlaci√≥n:**

```{r}
cor(cars$speed, cars$dist)
```

Dado que r=0.80689 es mayor que 0.75 ==\> la velocidad y la distancia del m√≥vil se relacionan aceptablemente en forma directa ( a medida que x crece, la otra variable y tambi√©n crece).

En generaL:

Si r\> 0.75 ==\> hay una muy buena relaci√≥n lineal creciente entre x e y.

Si r\< -0.75 ==\> hay una muy buena relaci√≥n lineal decreciente entre x e y.

**El modelo:**

```{r}
modelC<-lm(cars$dist~cars$speed, data=cars) # obligatorio aqui: primero Y, luego X

summary(modelC)

```

Beta 0= bo=Intercepto con eje Y= -17.5791

Beta 1= b1= pendiente = 3.9324

**Interpretaciones de los coeficientes:**

Beta 0: Cuando la velocidad es CERO, la distancia de frenado es -17.5791. ( No tiene interpretaci√≥n real)

Beta 1: por cada 1metro/ seg que aumente la velocidad, la distancia de frenado aumentar√≠a en promedio en 3.9324 metros.

**Ecuaci√≥n estimada de regresi√≥n:**

$$
\hat{y}=-17.5791+3.9324(x)
$$

**Modelo estad√≠stico:**

$$
y=-17.5791+3.9324(x)+ ei
$$

### Hasta aqu√≠ por hoy Martes 20

\#################################

**PRUEBAS DE HIP√ìTESIS EN REGRESI√ìN.**

1)  **Prueba de significancia de coeficientes:**

aqu√≠ lo que se prueba es determinar si los betas son o no son apropiados (para cada beta).

Como hay dos Betas, se debe hacer dos pruebas de hip√≥tesis.

**PARA EL EJEMPLO DE CARS:**

```{r}
modelC<-lm(cars$dist~cars$speed, data=cars) # obligatorio aqui: primero Y, luego X

summary(modelC)
```

```{r}
qt(0.95,48)
```

*Prueba de* $\beta  _{0}$

$$
Ho: \beta_{0} =0  \text{ es decir no es significativo o  no es apropiado}
$$

$$
Ha: \beta_{0} \ne 0 \text{ es decir si es significativo o  si es apropiado}
$$

Se puede probar usando el Pvalor que est√° en el reporte de ***modelC***

*P valor = 0.0123 \<* alfa= 0.05 ==\> Rechazo Ho: b0 es diferente de cero ==\> *es significativo.*

*Prueba de* $\beta _{1}$

$$
Ho: \beta_{1} =0  \text{ no significativo}
$$

$$
Ha: \beta_{1} \ne 0  \text{ si significativo}
$$

*P valor aprox 0* \< alfa=0.05 ==\> rechazo Ho ==\> b1 es diferente de cero ==\> *es significativo.*

**NOTA:** Aquel que tenga el Pvalor mas peque√±o de los coeficientes ser√° el mas significativo.

2\) **Prueba de significancia de todo el modelo:**

Sirva para determinar si todo el modelo (en conjunto) es o no apropiado

$$
Ho: \text{El modelo no es significativo o no es apropiado}
$$

$$
Ha: \text{El modelo si es significativo o es apropiado}
$$

Se toma el √∫ltimo P valor del reporte de *modelC* que est√° arriba:

*p valor aprox 0* \< alfa ==\> modelo significativo ==\> *es apropiado.*

3\) **Prueba general de coeficientes:**

Aqu√≠ se trata de probar si alg√∫n coeficiente toma o no, alg√∫n valor especificado.

Ejemplo 1) con alfa= 0.05

¬øSe puede afirmar que por cada 1 metro / seg, que se aumenta a la velocidad del m√≥vil, la distancia se incrementar√° en promedio ***en mas de 4 metros***?

Se est√° preguntando: ¬ø**Beta 1 \> 4**?

*Prueba general:*

$$
Ho: \beta_{1} \le 4
$$

$$
Ha: \beta_{1}> 4 
$$

**Del Word**:

Se rechazar√° Ho si

$$
T(\beta_{1})> t(1-\alpha, n-k-1)
$$

Siendo *k= \# de variables x ==\> en el problema solo hay una X (la velocidad del movil).*

$$
T(\beta_{1})=\frac{\beta_{1}- 4}{SE(\beta_{1})}
$$

En el problema, se halla el estad√≠stico de prueba:

$$
T(\beta_{1})=\frac{3.9324- 4}{0.4155}=- 0.1626
$$

**Valor cr√≠tico:**

$$
t(1-\alpha, n-k-1)
$$

Aqu√≠ solo hay una X ==\> k=1, n=50 ( Cars tiene 50 datos)

==\> $t(0.95,48)$

```{r}
qt(0.95, 48)
```

dado que la regi√≥n sombreada inicia en el Valor cr√≠tico, entonces el estad√≠stico de prueba, cae en la regi√≥n no sombreada y por ello debo aceptar Ho. Luego:

$$
\beta_{1} \le 4
$$

```{r}
pt(-0.16, 48)
```

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Ejemplo 2:

¬øSe puede afirmar que por cada 1 metro / seg, que se aumenta a la velocidad del m√≥vil, la distancia se incrementar√° en promedio ***en una cantidad diferente de 4 metros***?

Se est√° preguntando: ¬ø**Beta 1 diferente de 4**?

*Prueba general:*

$$ Ho: \beta_{1} = 4 $$

$$ Ha: \beta_{1} \ne 4  $$

**Del Word**:

Se rechazar√° Ho si

$$ |T(\beta_{1})|> t(1-\alpha /2, n-k-1) $$

Siendo *k= \# de variables x ==\> en el problema solo hay una X (la velocidad del movil).*

$$ T(\beta_{1})=\frac{\beta_{1}- 4}{SE(\beta_{1})} $$

En el problema, se halla el estad√≠stico de prueba:

$$ T(\beta_{1})=\frac{3.9324- 4}{0.4155}=- 0.1626 $$

**Valor cr√≠tico:**

$$ t(1-\alpha/2, n-k-1) $$

Aqu√≠ solo hay una X ==\> k=1, n=50 ( Cars tiene 50 datos)

==\> $t(0.975,48)$

```{r}
qt(0.975, 48)
```

dado que la regi√≥n sombreada inicia en el Valor cr√≠tico, y aqu√≠ es una prueba de doble cola, entonces el estad√≠stico de prueba, cae en la regi√≥n no sombreada y por ello debo aceptar Ho. Luego:

$$ \beta_{1} = 4 $$

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

**TABLA DE AN√ÅLISIS DE VARIANZA EN REGRESI√ìN (ANOVA O ANAVA EN REGRESI√ìN)**

Para hacer la prueba de hip√≥tesis:

$$
Ho: modelo\ no \ significativo
$$

$$
Ha: modelo \ significativo
$$

Se debe preparar una tabla de ANOVA (an√°lisis de varianza)

+------------------+--------------------------------+----------------------------------+-----------------------------+-----------------------+------------------+
| Fuente           | GL                             | SC                               | CM                          | Fo                    | P valor          |
+==================+================================+==================================+=============================+=======================+==================+
|                  | Grado de libertad              | Suma de cuadrados                | Cuadrado Medio              | Estad√≠stico de prueba | P valor          |
+------------------+--------------------------------+----------------------------------+-----------------------------+-----------------------+------------------+
| **Regresi√≥n**    | **k:** Cantidad de variables X | **SCR**                          | $CMR=\frac{SCR}{k}$         | $$                    | $$               |
|                  |                                |                                  |                             | F_{0}=\frac{CMR}{CME} | p(F(k,n-k-1))>F0 |
|                  |                                | suma de cuadrados de regresi√≥n.  | cuadrado medio de regresi√≥n | $$                    | $$               |
+------------------+--------------------------------+----------------------------------+-----------------------------+-----------------------+------------------+
| **Error**        | **n-k-1**                      | **SCE**                          | $CME=\frac{SCE}{n-k-1}$     |                       |                  |
|                  |                                |                                  |                             |                       |                  |
|                  |                                | suma de cuadrados del error.     | Cuadrado medio del error.   |                       |                  |
+------------------+--------------------------------+----------------------------------+-----------------------------+-----------------------+------------------+
| **Total**        | **n-1**                        | **SCT**                          |                             |                       |                  |
|                  |                                |                                  |                             |                       |                  |
|                  |                                | suma de cuadrados del total.     |                             |                       |                  |
+------------------+--------------------------------+----------------------------------+-----------------------------+-----------------------+------------------+

NOTAS:

1\) SCR + SCE = SCT

2\) Esta tabla calcula el p valor para probar que el modelo es o no significativo.

3\) Coeficiente de determinaci√≥n =

$$
Coef de determinaci√≥n= r^{2}= \frac{SCR}{SCT}
$$

Es coeficiente de determinaci√≥n se expresa en porcentaje:

$$
R^{2}: \text{indica el porcentaje de la variable y que es afectada por la variable x o tambien indica cuanto influye la recta de regresi√≥n en el  modelo}
$$
