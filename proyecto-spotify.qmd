---
title: "Proyecto-Spotify"
format: html
editor: visual
---

# Preferencia musical de los estudiantes universitarios de Lima según datos de Spotify

Proyecto realizado para el curso de Estadística y Probabilidades II: @Utec

## Relevancia

-   **Aplicaciones de datos en IA:** El uso de Inteligencia Artificial (IA) en Spotify incluye el reconocimiento de emociones en canciones, lo que sirve para mejorar listas de reproducción personalizadas y la experiencia general del usuario. Al analizar elementos como el tono, el tempo y la letra de una canción, Spotify puede determinar el estado de ánimo que transmite y sugerir música que se alinee con las emociones o el estado mental del usuario. Por ejemplo, si un usuario tiende a escuchar canciones tranquilas y melódicas por la noche, Spotify puede identificar esta tendencia y recomendar canciones similares durante ese momento del día. Además, Spotify utiliza algoritmos de aprendizaje automático en su sistema de recomendación. Estos algoritmos consideran factores como la popularidad de la canción, las tendencias musicales actuales y lo que están escuchando los usuarios con gustos similares. Esto permite a Spotify ofrecer recomendaciones altamente personalizadas.

-   **Aplicaciones de datos en marketing:** ¿Cómo contribuye el análisis estadístico de datos musicales al marketing actual? La música es parte de la vida diaria de las personas y las empresas están interesadas en satisfacer las necesidades principales de sus usuarios. Considerando a Spotify como una de las aplicaciones de música más conocidas hoy en día, la recolección de sus datos presenta una fuente interesante de información para el marketing de la empresa, especialmente porque son datos públicos. Las empresas a menudo utilizan datos de Spotify para centrarse en analizar los comportamientos y preferencias de los usuarios con el fin de crear estrategias más efectivas. Esto podría incluir segmentación de audiencia y personalización de mensajes publicitarios, colaboraciones con músicos populares (o en tendencia), o análisis probabilístico tanto de tendencias actuales como futuras.

## Objetivos

Este es un estudio que recopila datos de múltiples estudiantes universitarios de Lima con el objetivo de encontrar patrones en sus preferencias musicales. Realizaremos casos de estudio donde investigaremos

-   [ ] Estudio de la variable 'danceability', variable cuantitativa continua que mide qué tan bailable es una canción.
-   [ ] Relación entre la 'danceability' y la edad.
    -   Hipótesis: La 'danceability' promedio de las canciones escuchadas es mayor al 50% en personas entre las edades de 15 y 25 años.
-   [ ] ¿Qué tan variada es la música que la gente escucha según su edad y distrito?
-   [ ] ¿Cómo ha evolucionado la intensidad promedio de las canciones con el tiempo (edad del oyente)?

## Obtención de datos

Cada entrada en el conjunto de datos corresponderá al ID de usuario de un estudiante y tendrá como valor una lista de artistas que escuchan, el número de veces que los escuchan, entre otros. Los datos se obtendrán de la API de Spotify, con el siguiente código (simplificado):

``` python
# Authorize and Authenticate
# ...

from spotipy import Spoify

top_artists: Const = spotify.current_user_top_artists()
top_tracks: Const = spotify.current_user_top_tracks()

listened_artists: Spotify.Artist[] = []

# Extra data
for track in top_tracks["items"]:
    features = spotify.audio_features(track["id"])
    analysis = spotify.audio_analysis(track["id"])
    listened_artists.merge(track["artists"]['items'])
```

Para obtener los IDs de usuario y los datos, necesitaremos crear un sistema de autenticación que nos permita obtener los datos de las personas. Además, tendremos un canal de datos que extraerá información relevante de la API de Spotify y la almacenará en Google Sheets, que luego se podrá exportar a un CSV y finalmente a un dataframe de R.

## Integrantes

+---------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+
| ![Arturo Magno](https://avatars.githubusercontent.com/u/104233007?v=4){alt="Arturo Magno"}\ | ![Valentin Quezada](https://avatars.githubusercontent.com/u/91209653?v=4){alt="Valentin Quezada"}\ | ![Enrique Flores](https://avatars.githubusercontent.com/u/60308719?v=4){alt="Enrique Flores"}\ |
| [Arturo Magno](https://github.com/xkal1bur)                                                 | [Valentin Quezada](https://github.com/ValentinQuezada)                                             | [Enrique Flores](https://github.com/Enriquefft)                                                |
+---------------------------------------------------------------------------------------------+----------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------+

## Variables utilizadas en el estudio

Este estudio requiere que los usuarios proporcionen sus datos de Spotify, lo cual podría ser un problema para algunas personas. Necesitaremos asegurarnos de que los datos estén anonimizados y que los usuarios estén al tanto de qué datos estamos recopilando y cómo los estamos utilizando. Teniendo todo esto en cuenta, esperamos que una aplicación web atractiva nos ayude a obtener una buena cantidad de datos. En cuanto al público objetivo, esperamos obtener una buena cantidad de datos de los estudiantes de UTEC, así como de otras universidades en Lima, especialmente si consideramos que casi todos los estudiantes universitarios utilizan Spotify.

La cantidad mínima de datos que necesitamos son 200 entradas, pero para un estudio más robusto, necesitaríamos al menos 500 entradas. En el peor de los casos, los datos serán principalmente de UTEC, lo que generará sesgo en el primer objetivo. No obstante, intearemos recopilar la mayor cantidad de data posible, variada en su mayoría.

#### Variables primarias

+-------------------------------+-----------------------+------------------------------------------------------------+
| Variable                      | Tipo                  | Restricciones                                              |
+===============================+=======================+============================================================+
| Centro de estudio             | Nominal categórica    | Ninguna                                                    |
+-------------------------------+-----------------------+------------------------------------------------------------+
| Edad                          | Cuantitativa discreta | \~ \[15, 40\]                                              |
+-------------------------------+-----------------------+------------------------------------------------------------+
| Distrito                      | Nominal categórica    | Distritos de Lima, Perú                                    |
+-------------------------------+-----------------------+------------------------------------------------------------+
| Variedad musical percibida    | Nominal ordinal       | {Ninguna (1), Baja (2), Media (3), Alta (4), Muy alta (5)} |
+-------------------------------+-----------------------+------------------------------------------------------------+
| Géneros preferidos percibidos | Nominal categórica    | Géneros musicales de Spotify                               |
+-------------------------------+-----------------------+------------------------------------------------------------+

#### Variables secundarias

+---------------------------------------------------------+-------------------+-----------------+
| Variable                                                | Tipo              | Restricciones   |
+=========================================================+===================+=================+
| 'Danceability' promedio de canciones favoritas          | Numérica continua | \[0, 1\]        |
+---------------------------------------------------------+-------------------+-----------------+
| Característica acústica promedio de canciones favoritas | Numérica continua | \[0, 1\]        |
+---------------------------------------------------------+-------------------+-----------------+
| Nivel de energía promedio de canciones favoritas        | Numérica continua | \[0, 1\]        |
+---------------------------------------------------------+-------------------+-----------------+
| Intensidad de volumen promedio de canciones favoritas   | Numérica continua | \[-60, 0\] DB   |
+---------------------------------------------------------+-------------------+-----------------+
| Promedio de artistas escuchados por año                 | Numérica continua | $\mathbb{R}^+$  |
+---------------------------------------------------------+-------------------+-----------------+
| Duración promedio de canciones del género Pop           | Numérica continua | \[0, 60000\] ms |
+---------------------------------------------------------+-------------------+-----------------+
| ... de canciones del género Rock                        | Numérica continua | \[0, 60000\] ms |
+---------------------------------------------------------+-------------------+-----------------+
| ... de canciones del género Reggaeton                   | Numérica continua | \[0, 60000\] ms |
+---------------------------------------------------------+-------------------+-----------------+
| ... de canciones del género Blues                       | Numérica continua | \[0, 60000\] ms |
+---------------------------------------------------------+-------------------+-----------------+
| Tasa de artistas preferidos en el género Pop            | Numérica continua | \[0, 1\]        |
+---------------------------------------------------------+-------------------+-----------------+
| ... en el género Rock                                   | Numérica continua | \[0, 1\]        |
+---------------------------------------------------------+-------------------+-----------------+
| ... en el género Reggaeton                              | Numérica continua | \[0, 1\]        |
+---------------------------------------------------------+-------------------+-----------------+
| ... en el género blues                                  | Numérica continua | \[0, 1\]        |
+---------------------------------------------------------+-------------------+-----------------+

```{r, message=FALSE, warning=FALSE}
librerias <- c("dplyr", "readr", "DBI")
for (paquete in librerias) {
  if (!require(paquete, character.only = TRUE)) {
    install.packages(paquete)
  }
	library(paquete, character.only = TRUE)
}
```

```{r}
DF <- read.csv("Data_Spotify.csv")
head(DF)
summary(DF$age)
```

# Caso de Estudio #1

## Distribución de la media muestral de 'danceability' para los encuestados entre 15 a 18 años.

El objetivo del primer caso de estudio es evaluar la variable 'danceability' en encuestados entre las edades de 15 y 18 años. Tenemos como dato la media de la población, $\mu$, que podemos calcular usando RStudio. Luego, filtramos la base de datos para los encuestados que tienen entre 15 y 18 años. Esta será nuestra muestra, y entonces buscamos su tamaño (n) y la desviación muestral (s).

```{r}
library("dplyr")
mu = mean(DF$danceability)
DFD <- filter(DF,age >= 15 & age <= 18)
n = sum(complete.cases(DFD))
s = sd(DFD$danceability)
paste("mu =", mu)
paste("n =", n)
paste("s =", s)
```

Entendemos para este caso que, como el tamaño de muestra es menor a 30, la media muestral se distribuye con una T-student de $n-1$ grados de libertad. Con esta información, podemos ahora resolver los siguientes incisos:

#### a. ¿Cuál es la probabilidad de que la media muestral sea mayor a 0.65?

$$P(\overline{x}>0.65)$$

$$P\left(\frac{\overline{x}-\mu}{\frac{s}{\sqrt{n}}} > \frac{0.65-\mu}{\frac{s}{\sqrt{n}}}\right)$$

$$P\left(T(n-1)>\frac{0.65-\mu}{\frac{s}{\sqrt{n}}}\right)$$

```{r}
a <- (0.65 - mu)/(s/sqrt(n))
paste("La probabilidad de que la media muestral sea mayor a 0.65 es", pt(a,n-1, lower.tail = FALSE),".")
```

#### b. ¿Será posible determinar un intervalo de confianza para la media muestral? Consideremos un nivel de confianza del 95%.

```{r}
nc = 0.95
alpha = 1 - nc
test <- t.test(DFD$danceability, conf.level = nc)
```

```{r}
paste("El intervalo de confianza para la media poblacional es [", test$conf.int[1], ";", test$conf.int[2], "] con un nivel de confianza del 95%.")
```

```{r}
Xs <- seq(-5, 5, by = 0.001)
plot(Xs, dt(Xs,n-1), type = "l", col = "red")
lines(Xs[Xs > a], dt(Xs[Xs > a],n-1), col = "green")
abline(v = c(-test$conf.int[1], test$conf.int[2]), col = "blue")
legend("topright", legend = c("T(x,n-1)", "respuesta de la a.", "respuesta de la b."), col = c("red", "green","blue"), lty = 1)
```

# Caso de estudio #2

## Distribución de la varianza muestral de la variedad musical de los encuestados.

El objetivo del segundo caso de estudio es evaluar la variable 'perceived_variety'. No obstante, nos falta como dato la varianza de la población, $\sigma^2$, para poder trabajar el caso. Nuestra base de datos entera servirá en este caso como muestra, y al ser de un tamaño mayor a 30, podemos aproximar la varianza muestral a la varianza poblacional. El principal objetivo será entonces calcular la varianza poblacional usando RStudio, pero para ello, primero debemos refactorizar la data nominal a numérica:

```{r}
numeric_variety <- as.numeric(factor(DF$percieved_variety))
v = var(numeric_variety)
n = sum(complete.cases(DF))
paste("v =", v)
paste("n =", n)
```

#### a. ¿Cuál sería la máxima varianza muestral con probabilidad 0.90?

$$
P(s^2\leq m) = 0.90
$$

$$
P\left(\frac{s^2(n-1)}{\sigma^2}\leq\frac{m(n-1)}{\sigma^2}\right)=0.90
$$

$$
P\left(\chi^2_{(n-1)}\leq\frac{m(n-1)}{\sigma^2}\right)=0.90
$$

```{r}
m = qchisq(0.90,n-1) * v / (n-1)
paste("La máxima varianza muestral con probabilidad 0.90 es", m,".")
```

#### b. ¿Será posible determinar un intervalo de confianza para la varianza poblacional? Consideremos un nivel de confianza del 95%.

```{r}
nc = 0.95
alpha = 1 - nc
superior = (n-1) * v / qchisq(alpha/2,n-1)
inferior = (n-1) * v / qchisq(1-alpha/2,n-1)
paste("El intervalo de confianza para la varianza poblacional es [", inferior, ";", superior, "].")
```

# Caso de estudio #3

Distribución de la diferencia de medias de la intensidad de la música escuchada por los encuestados de edad mayor a 20 años y la intensidad de la música escuchada por los encuestados de edad menor a 20 años.

```{r}
library("dplyr")
DF %>%
  filter(age <= 20) %>%
  select(loudness) -> df1
DF %>%
  filter(age > 20) %>%
  select(loudness) -> df2
```

```{r}
# Parámetros
mu1 <- mean(df1$loudness)
mu2 <- mean(df2$loudness)
s1 <- sd(df1$loudness)
s2 <- sd(df2$loudness)
n1 <- length(df1$loudness)
n2 <- length(df2$loudness)
paste("mu1 =", mu1)
paste("mu2 =", mu2)
paste("s1 =", s1)
paste("s2 =", s2)
paste("n1 =", n1)
paste("n2 =", n2)
```

¿Cual es la distribución de la diferencia de medias?

Calculamos si la varianza es igual o diferente:

```{r}
var.test(df1$loudness, df2$loudness, ratio = 1, alternative = "two.sided", conf.level = 0.95)
```

Vemos que las varianzas son diferentes.

Estamos en el caso de: no se conoce $\sigma_1$ y $\sigma\_2$ pero se sabe que son diferentes.

$$ 
\begin{align*}
& T(v) = \frac{\overline{X}_1 - \overline{X}_2 - (\mu_1 - \mu_2)} {\sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}} \,,\text{ siendo} \\

v &= \frac{\left(\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}\right)^2} {\frac{\left(\frac{s_1^2}{n_1}\right)^2}{n_1 - 1} + \frac{\left(\frac{s_2^2}{n_2}\right)^2}{n_2 - 1}} = \text{grados de libertad} 
\end{align*} 
$$

Valores importantes

```{r}
m <- mu1 - mu2 
s <- sqrt((s1^2/n1) + (s2^2/n2)) 
v <- round( (s1^2/n1 + s2^2/n2)^2/((s1^2/n1)^2/(n1-1) + (s2^2/n2)^2/(n2-1))  )

alpha <- 0.05
t <- qt(1-alpha/2,v)
```

#### a. ¿Cuál es la probabilidad de que, en promedio, la intensidad de la música escuchada por los encuestados menores a 25 años supere en 10 decibeles a la intensidad de la música escuchada por los encuestados mayores a 25 años?

$$
\mathbb{P}(\overline{X}_1 - \overline{X}_2 > 10) = 1 - \mathbb{P}(\overline{X}_1 - \overline{X}_2 \leq 10) = 1 - \mathbb{P}\left(T(v) \leq \frac{10 - (\mu_1 - \mu_2)}{\sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}}\right)
$$

```{r}
x <- 10
pt((x-m)/s,v, lower.tail = FALSE)
```

#### b. Con 95% de confianza, ¿cuál es el intervalo de confianza para la diferencia de medias?

El intervalo de confianza se calcula con la fórmula:

$$
\mathbb{P}\left(\overline{X}_1 - \overline{X}_2 - t_{(1-\alpha/2,v)} \cdot \sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}} \leq \mu_1 - \mu_2 \leq \overline{X}_1 - \overline{X}_2 + t_{(1-\alpha/2,v)} \cdot \sqrt{\frac{s_1^2}{n_1} + \frac{s_2^2}{n_2}}\right) = 0.95
$$

El intervalo de confianza es:

```{r}
ic <- m + c(-1,1)*t*s
paste("El intervalo de confianza para la varianza poblacional es [", ic[1], ";", ic[2], "] con un nivel de confianza del 95%.")
```

Otra forma de calcularlo:

```{r}
t.test(df1$loudness, df2$loudness, alternative = "two.sided", var.equal = FALSE, conf.level = 0.95)
```

¿Cómo se ve la distribución de la diferencia de medias?

```{r}
Xs <- seq(-7, 7, by = 0.001)
plot(Xs, dt(Xs,v), type = "l", col = "red")
abline(v = c(ic[1], ic[2]), col = "blue")
lines(Xs[Xs > t], dt(Xs[Xs > t],v), col = "green")
legend("topright", legend = c("T(x,v)", "respuesta de la a.", "respuesta de la b."), col = c("red","green", "blue"), lty = 1)
```

# Caso de estudio #4

Consideremos la muestra de encuestados utilizada. ¿Será posible afirmar a partir de la edad de los encuestados que la muestra escogida es aleatoria con un nivel de confianza del 95%?

Planteamos como hipótesis las siguientes:

$$
Ho: \text{la muestra es aleatoria}
$$

$$
Ha: \text{la muestra no es aleatoria}
$$

Y corremos el *runs.test* sobre la columna 'Age' para hallar el $p-valor$:

```{r}
library("randtests")
runs.test(DF$age)
```

**Conclusión:** Como el $p-valor=0.4139>\alpha=0.05$, aceptamos Ho con un 5% de significación. Es decir, podemos afirmar que la muestra es aleatoria (en relación a las edades) con un 95% de confianza.

# Caso de estudio #5

'Energy' es una variable que mide el nivel enérgico promedio de las canciones que escuchan los encuestados. Haciendo un resumen de la variable:

```{r}
summary(DF$energy)
sd(DF$energy)
```

Vemos que su media es aproximadamente 0.6934 y su mediana 0.7130. Se plantea entonces la siguiente cuestión: ¿será posible afirmar que la variable 'Energy' de la base de datos sigue una normal de media 0.70 y desviación estándar 0.10?

Planteamos como hipótesis las siguientes:

$$
Ho: \text{Los datos de 'energy' siguen una Normal con media 0.70 y desviación 0.10}
$$

$$
Ha: \text{Los datos de 'energy' no siguen una normal con media 0.70 y desviación 0.10}
$$

Para ello, corremos el *ks.test* en la variable 'energy':

```{r}
ks.test(DF$energy,pnorm,mean=0.70,sd=0.10)
```

**Conclusión:** Como el $p-valor=0<\alpha=0.05$, rechazamos Ho con un 5% de significación. Es decir, podemos afirmar que los datos de 'energy' no siguen una normal con media 0.70 y desviación 0.10 con un 95% de confianza.

## Referencias bibliográficas

-   Hujran, O., Alikaj, A., Durrani, U., & Al-Dmour, N. A. (2020). Big Data and its Effect on the Music Industry. ACM. https://doi.org/10.1145/3378936.3378957
-   Álvarez, P., De Quirós, J. G., & Baldassarri, S. (2023). RIADA: a Machine-Learning based infrastructure for recognising the emotions of Spotify songs. International Journal of Interactive Multimedia and Artificial Intelligence, 8(2), 168. https://doi.org/10.9781/ijimai.2022.04.002
-   Spotify for Developers. (18 de enero de 2024). https://developer.spotify.com/
